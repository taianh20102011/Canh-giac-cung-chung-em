<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>B√†i b√°o - C·∫£nh gi√°c c√πng ch√∫ng em</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>üì∞ B√†i b√°o chi ti·∫øt</h1>
    <nav>
      <a href="index.html">Trang ch·ªß</a>
      <a href="dangbai.html">ƒêƒÉng b√†i</a>
    </nav>
  </header>

  <section>
    <div class="card" id="baibaoCard">
      <p>‚è≥ ƒêang t·∫£i n·ªôi dung...</p>
    </div>
  </section>

  <footer>
    <p>¬© 2025 - C·∫£nh gi√°c c√πng ch√∫ng em</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA-w4aviFPK1-wtE_pVN01saRCq5bdgL9c",
      authDomain: "cungchungemcanhgiac.firebaseapp.com",
      projectId: "cungchungemcanhgiac",
      storageBucket: "cungchungemcanhgiac.appspot.com",
      messagingSenderId: "24327141155",
      appId: "1:24327141155:web:139b53155d697a7af87e96"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // L·∫•y id t·ª´ URL
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    const baibaoCard = document.getElementById("baibaoCard");

    async function loadBaiBao() {
      if (!id) {
        baibaoCard.innerHTML = "<p>‚ùå Kh√¥ng t√¨m th·∫•y ID b√†i b√°o.</p>";
        return;
      }

      try {
        const ref = doc(db, "bai_bao", id);
        const snap = await getDoc(ref);

        if (!snap.exists()) {
          baibaoCard.innerHTML = "<p>‚ùå B√†i b√°o kh√¥ng t·ªìn t·∫°i.</p>";
          return;
        }

        const data = snap.data();

        let html = `
          <h2>${data.tieuDe}</h2>
          <small>‚úçÔ∏è ${data.tacGia || "B·∫°n ƒë·ªçc"} ‚Äî ${data.time?.toDate ? data.time.toDate().toLocaleString("vi-VN") : ""}</small>
        `;

        if (data.anhBase64) {
          html += `<div><img src="${data.anhBase64}" style="max-width:100%;margin:12px 0;border-radius:8px;"></div>`;
        }

        if (data.noiDung) {
          html += `<p style="white-space:pre-wrap;">${escapeHtml(data.noiDung)}</p>`;
        }

        baibaoCard.innerHTML = html;
      } catch (err) {
        console.error(err);
        baibaoCard.innerHTML = "<p>‚ùå L·ªói khi t·∫£i b√†i b√°o.</p>";
      }
    }

    function escapeHtml(t) {
      return t ? t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;") : "";
    }

    loadBaiBao();
  </script>
</body>
</html>

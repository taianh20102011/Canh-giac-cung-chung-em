<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>S√°ng t·∫°o</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header>
    <h1>üåü G√≥c S√°ng t·∫°o</h1>
    <p>Poster, video, ·∫£nh chibi tuy√™n truy·ªÅn do h·ªçc sinh t·ª± thi·∫øt k·∫ø</p>
  </header>
  <nav>
    <a href="Trang_chu.html">Trang ch·ªß</a>
    <a href="chieutro.html">Chi√™u tr√≤</a>
    <a href="5khong5nen.html">5 KH√îNG - 5 N√äN</a>
    <a href="phanung.html">Ph·∫£n ·ª©ng nhanh</a>
    <a href="sangtao.html">S√°ng t·∫°o</a>
    <a href="tracnghiem.html">Tr·∫Øc nghi·ªám</a>
    <a href="tuongtac.html">T∆∞∆°ng t√°c</a>
  </nav>

  <section>
    <form id="formSangTao">
      <input type="text" id="tenSangTao" placeholder="T√™n c·ªßa b·∫°n">
      <textarea id="moTa" rows="3" placeholder="M√¥ t·∫£ √Ω t∆∞·ªüng"></textarea>
      <input type="file" id="anh" accept="image/*">
      <button type="submit">üì§ G·ª≠i s√°ng t·∫°o</button>
    </form>
    <div id="dsSangTao"></div>
  </section>

  <footer>
    <p>¬© 2025 - THCS L√Ω T·ª± Tr·ªçng G√≤ V·∫•p</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // üîë Config Firebase (b·∫°n nh·ªõ b·∫≠t Realtime Database trong Firebase Console)
    const firebaseConfig = {
      apiKey: "AIzaSyA-w4aviFPK1-wtE_pVN01saRCq5bdgL9c",
      authDomain: "cungchungemcanhgiac.firebaseapp.com",
      databaseURL: "https://cungchungemcanhgiac-default-rtdb.firebaseio.com",
      projectId: "cungchungemcanhgiac",
      storageBucket: "cungchungemcanhgiac.appspot.com",
      messagingSenderId: "24327141155",
      appId: "1:24327141155:web:139b53155d697a7af87e96"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // üîÑ Chuy·ªÉn file ·∫£nh sang Base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
      });
    }

    // üì§ G·ª≠i s√°ng t·∫°o
    const formST = document.getElementById("formSangTao");
    formST.addEventListener("submit", async (e) => {
      e.preventDefault();
      const ten = document.getElementById("tenSangTao").value.trim();
      const moTa = document.getElementById("moTa").value.trim();
      const file = document.getElementById("anh").files[0];

      if (!ten || !moTa) {
        alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n v√† m√¥ t·∫£");
        return;
      }

      let anhBase64 = "";
      if (file) {
        anhBase64 = await fileToBase64(file);
      }

      push(ref(db, "sang_tao"), {
        ten,
        moTa,
        anhBase64,
        time: Date.now()
      });

      formST.reset();
    });

    // üëÄ Hi·ªÉn th·ªã realtime
    const dsBox = document.getElementById("dsSangTao");
    onValue(ref(db, "sang_tao"), (snapshot) => {
      dsBox.innerHTML = "";
      const data = snapshot.val();
      if (!data) return;
      Object.values(data)
        .sort((a, b) => b.time - a.time) // m·ªõi nh·∫•t l√™n ƒë·∫ßu
        .forEach((d) => {
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `<b>${d.ten}</b>: ${d.moTa}`;
          if (d.anhBase64) {
            const img = document.createElement("img");
            img.src = d.anhBase64;
            img.style.maxWidth = "100%";
            img.style.marginTop = "8px";
            div.appendChild(img);
          }
          dsBox.appendChild(div);
        });
    });
  </script>
</body>


</html>

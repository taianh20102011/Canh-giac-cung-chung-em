<!DOCTYPE html>
<html lang="vi">
<head>
<meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval'
          https://www.gstatic.com https://www.googleapis.com https://apis.google.com
          https://*.firebaseio.com https://*.firebaseapp.com;
        connect-src 'self'
          https://firestore.googleapis.com
          https://firebasestorage.googleapis.com
          https://securetoken.googleapis.com
          https://identitytoolkit.googleapis.com
          https://www.googleapis.com
          https://www.gstatic.com
          https://*.firebaseio.com
          wss://*.firebaseio.com;
        frame-src https://apis.google.com https://*.firebaseapp.com https://*.web.app;
        img-src 'self' data: https:;
      ">

  <link rel="stylesheet" href="style.css">
  <style>
    /* Loader animation */
    .loader {
      width: 60px;
      height: 60px;
      border: 6px solid #ddd;
      border-top-color: #514b82;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .hidden { display: none !important; }
    .center { text-align: center; }
  </style>
</head>

<body>
  <header>
    <h1>üåü G√≥c S√°ng t·∫°o</h1>
    <p>Poster, video, ·∫£nh chibi tuy√™n truy·ªÅn do h·ªçc sinh t·ª± thi·∫øt k·∫ø</p>
  </header>
  <nav>
    <a href="index.html">Trang ch·ªß</a>
    <a href="chieutro.html">Chi√™u tr√≤</a>
    <a href="5khong5nen.html">5 KH√îNG - 5 N√äN</a>
    <a href="phanung.html">Ph·∫£n ·ª©ng nhanh</a>
    <a href="sangtao.html">S√°ng t·∫°o</a>
    <a href="tracnghiem.html">Tr·∫Øc nghi·ªám</a>
    <a href="tuongtac.html">T∆∞∆°ng t√°c</a>
    <a href="dangbai.html">ƒêƒÉng b√†i</a>
  </nav>

  <section>
    <form id="formSangTao">
      <input type="text" id="tenSangTao" placeholder="T√™n c·ªßa b·∫°n">
      <textarea id="moTa" rows="3" placeholder="M√¥ t·∫£ √Ω t∆∞·ªüng"></textarea>
      <input type="file" id="anh" accept="image/*">
      <button type="submit">üì§ G·ª≠i s√°ng t·∫°o</button>
      <div id="submitLoader" class="loader hidden"></div>
    </form>

    <div id="listLoader" class="loader"></div>
    <div id="dsSangTao"></div>
  </section>

  <footer>
    <p>¬© 2025 - THCS L√Ω T·ª± Tr·ªçng G√≤ V·∫•p</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA-w4aviFPK1-wtE_pVN01saRCq5bdgL9c",
      authDomain: "cungchungemcanhgiac.firebaseapp.com",
      databaseURL: "https://cungchungemcanhgiac-default-rtdb.firebaseio.com",
      projectId: "cungchungemcanhgiac",
      storageBucket: "cungchungemcanhgiac.appspot.com",
      messagingSenderId: "24327141155",
      appId: "1:24327141155:web:139b53155d697a7af87e96"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Convert file ‚Üí Base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
      });
    }

    const formST = document.getElementById("formSangTao");
    const submitLoader = document.getElementById("submitLoader");
    const listLoader = document.getElementById("listLoader");
    const dsBox = document.getElementById("dsSangTao");

    // üì§ G·ª≠i s√°ng t·∫°o
    formST.addEventListener("submit", async (e) => {
      e.preventDefault();
      const ten = document.getElementById("tenSangTao").value.trim();
      const moTa = document.getElementById("moTa").value.trim();
      const file = document.getElementById("anh").files[0];

      if (!ten || !moTa) {
        alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n v√† m√¥ t·∫£");
        return;
      }

      submitLoader.classList.remove("hidden");

      try {
        let anhBase64 = "";
        if (file) {
          anhBase64 = await fileToBase64(file);
        }

        await push(ref(db, "sang_tao"), {
          ten,
          moTa,
          anhBase64,
          time: Date.now()
        });

        formST.reset();
      } catch (err) {
        console.error("‚ùå L·ªói khi l∆∞u:", err);
        alert("‚ö†Ô∏è Kh√¥ng th·ªÉ g·ª≠i s√°ng t·∫°o!");
      } finally {
        submitLoader.classList.add("hidden");
      }
    });

    // üëÄ Hi·ªÉn th·ªã realtime
    onValue(ref(db, "sang_tao"), (snapshot) => {
      dsBox.innerHTML = "";
      listLoader.classList.add("hidden");

      const data = snapshot.val();
      if (!data) {
        dsBox.innerHTML = "<p class='center'>Ch∆∞a c√≥ s√°ng t·∫°o n√†o.</p>";
        return;
      }

      Object.values(data)
        .sort((a, b) => b.time - a.time)
        .forEach((d) => {
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `<b>${d.ten}</b>: ${d.moTa}`;
          if (d.anhBase64) {
            const img = document.createElement("img");
            img.src = d.anhBase64;
            img.style.maxWidth = "100%";
            img.style.marginTop = "8px";
            div.appendChild(img);
          }
          dsBox.appendChild(div);
        });
    });
  </script>
</body>
</html>




